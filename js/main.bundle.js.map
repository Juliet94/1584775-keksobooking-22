{"version":3,"sources":["webpack://keksobooking/./source/js/card-advert.js","webpack://keksobooking/./source/js/utility.js","webpack://keksobooking/./source/js/popup-message.js","webpack://keksobooking/./source/js/server.js","webpack://keksobooking/./source/js/preview.js","webpack://keksobooking/./source/js/form.js","webpack://keksobooking/./source/js/map.js","webpack://keksobooking/./source/js/filter.js"],"names":["cardTemplate","document","querySelector","content","closeOnEsc","evt","key","isEscEvent","preventDefault","body","removeChild","lastChild","target","removeEventListener","closeOnClick","remove","closeOnClickButton","closest","onShowError","addEventListener","errorMessage","closeErrorButton","cloneNode","showErrorMessageSend","textContent","appendChild","successMessage","SERVER","FILE_TYPES","showPreview","input","preview","file","files","fileName","name","toLowerCase","some","it","endsWith","reader","FileReader","src","result","readAsDataURL","DEFAULT_IMG","filter","fieldsets","querySelectorAll","resetButton","type","price","timeIn","timeOut","room","capacity","avatarInput","photoInput","avatarPreview","photoPreview","classList","add","forEach","fieldset","setAttribute","onSelectCheckInOut","value","onSelectRoom","setCustomValidity","resetImg","resetForm","reset","resetMap","handleSuccess","formData","FormData","onSuccess","onFail","fetch","method","then","response","ok","catch","centerTokyo","map","L","on","removeAttribute","setView","lat","lng","tileLayer","attribution","addTo","mainPinIcon","icon","iconUrl","iconSize","iconAnchor","MAIN_ICON_SIZE","mainPinMarker","marker","draggable","address","toFixed","getCoordinates","getLatLng","setLatLng","markers","layerGroup","usualPinIcon","USUAL_ICON_SIZE","renderSimilarAdverts","adverts","advert","usualPinMarker","location","addLayer","bindPopup","advertElement","fragment","createDocumentFragment","offer","title","defineType","rooms","guests","checkin","checkout","features","featureList","includes","removeFeature","description","photos","length","photoElement","index","insertAdjacentHTML","getPhoto","author","avatar","showAdvert","keepInView","DEFAULT","selects","housingType","housingPrice","housingRooms","housingGuests","housingFeatures","select","filterData","data","checkedFeatures","feature","onChangeFilter","func","wait","immediate","timeout","args","context","clearTimeout","setTimeout","apply","debounce","closePopup","clearLayers","similarAdverts","slice","json","placeholder","min"],"mappings":"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","file":"main.bundle.js","sourcesContent":["const cardTemplate = document.querySelector('#card')\n  .content\n  .querySelector('.popup');\n\nconst defineType = (type) => {\n  switch (type) {\n    case 'flat':\n      return 'Квартира';\n    case 'bungalow':\n      return 'Бунгало';\n    case 'house':\n      return 'Дом';\n    case 'palace':\n      return 'Дворец';\n  }\n}\n\nconst showAdvert = (adverts) => {\n\n  const removeFeature = (features) => {\n    const featureList = advertElement.querySelector('.popup__features');\n\n    if (!features.includes('wifi')) {\n      featureList.removeChild(featureList.querySelector('.popup__feature--wifi'))\n    }\n\n    if (!features.includes('dishwasher')) {\n      featureList.removeChild(featureList.querySelector('.popup__feature--dishwasher'))\n    }\n\n    if (!features.includes('parking')) {\n      featureList.removeChild(featureList.querySelector('.popup__feature--parking'))\n    }\n\n    if (!features.includes('washer')) {\n      featureList.removeChild(featureList.querySelector('.popup__feature--washer'))\n    }\n\n    if (!features.includes('elevator')) {\n      featureList.removeChild(featureList.querySelector('.popup__feature--elevator'))\n    }\n\n    if (!features.includes('conditioner')) {\n      featureList.removeChild(featureList.querySelector('.popup__feature--conditioner'))\n    }\n  }\n\n  const getPhoto = (photos) => {\n    const photoElement = advertElement.querySelector('.popup__photos').querySelector('.popup__photo');\n\n    advertElement.querySelector('.popup__photos').removeChild(photoElement);\n\n    photos.forEach((value, index) => {\n      advertElement.querySelector('.popup__photos').insertAdjacentHTML('beforeend', `<img src=\"${photos[index]}\" class=\"popup__photo\" width=\"45\" height=\"40\" alt=\"Фотография жилья\">`);\n    });\n  }\n\n  const advertElement = cardTemplate.cloneNode(true);\n  const fragment = document.createDocumentFragment();\n\n  advertElement.querySelector('.popup__title').textContent = adverts.offer.title;\n  advertElement.querySelector('.popup__text--address').textContent = adverts.offer.address;\n  advertElement.querySelector('.popup__text--price').textContent = adverts.offer.price + '₽/ночь';\n  advertElement.querySelector('.popup__type').textContent = defineType(adverts.offer.type);\n  advertElement.querySelector('.popup__text--capacity').textContent = `${adverts.offer.rooms} комнаты для ${adverts.offer.guests} гостей`;\n  advertElement.querySelector('.popup__text--time').textContent = `Заезд после ${adverts.offer.checkin}, выезд до ${adverts.offer.checkout}`;\n  removeFeature(adverts.offer.features);\n  advertElement.querySelector('.popup__description').textContent = adverts.offer.description;\n  if (adverts.offer.photos.length > 1) {\n    getPhoto(adverts.offer.photos);\n  } else {\n    advertElement.querySelector('.popup__photos').querySelector('.popup__photo').src = adverts.offer.photos;\n  }\n  advertElement.querySelector('.popup__avatar').src = adverts.author.avatar;\n\n  return(fragment.appendChild(advertElement));\n}\n\nexport {showAdvert};\n","/* Обработчики событий */\n\nconst isEscEvent = (evt) => {\n  return evt.key === 'Escape' || evt.key === 'Esc';\n};\n\nconst closeOnEsc = (evt) => {\n  if (isEscEvent(evt)) {\n    evt.preventDefault();\n    document.body.removeChild(document.body.lastChild);\n    evt.target.removeEventListener('keydown', closeOnEsc)\n  }\n}\n\nconst closeOnClick = (evt) => {\n  evt.preventDefault();\n  evt.target.remove();\n  evt.target.removeEventListener('click', closeOnClick)\n}\n\nconst closeOnClickButton = (evt) => {\n  evt.preventDefault();\n  evt.target.closest('div').remove();\n  evt.target.removeEventListener('click', closeOnClickButton)\n}\n\nconst debounce = (func, wait, immediate) => {\n  let timeout;\n\n  return (...args) => {\n    const context = this;\n\n    const later = () => {\n      timeout = null;\n      if (!immediate) {\n        func.apply(context, args);\n      }\n    };\n\n    const callNow = immediate && !timeout;\n\n    clearTimeout(timeout);\n\n    timeout = setTimeout(later, wait);\n\n    if (callNow) {\n      func.apply(context, args);\n    }\n  };\n}\n\nexport {\n  closeOnEsc,\n  closeOnClick,\n  closeOnClickButton,\n  debounce\n};\n","import {closeOnEsc, closeOnClick, closeOnClickButton} from './utility.js';\n\n/* Обработчики событий */\n\nconst onShowError = () => {\n  document.addEventListener('keydown',closeOnEsc);\n  errorMessage.addEventListener('click',closeOnClick);\n  closeErrorButton.addEventListener('click', closeOnClickButton);\n}\n\nconst onShowSuccess = () => {\n  document.addEventListener('keydown',closeOnEsc);\n  successMessage.addEventListener('click',closeOnClick);\n}\n\n/* Ошибка */\n\nconst errorTemplate = document.querySelector('#error')\n  .content\n  .querySelector('.error');\n\nconst errorMessage = errorTemplate.cloneNode(true);\nconst closeErrorButton = errorMessage.querySelector('.error__button');\n\nconst showErrorMessageGet = () => {\n  errorMessage.querySelector('.error__message').textContent = 'Ошибка загрузки данных похожих объявлений';\n  errorMessage.querySelector('.error__button').textContent = 'OK';\n  document.body.appendChild(errorMessage);\n  onShowError();\n}\n\nconst showErrorMessageSend = () => {\n  errorMessage.querySelector('.error__message').textContent = 'Ошибка размещения объявления';\n  errorMessage.querySelector('.error__button').textContent = 'Попробовать снова';\n  document.body.appendChild(errorMessage);\n  onShowError();\n}\n\n/* Успех */\n\nconst successTemplate = document.querySelector('#success')\n  .content\n  .querySelector('.success');\n\nconst successMessage = successTemplate.cloneNode(true);\n\nconst showSuccessMessageSend = () => {\n  document.body.appendChild(successMessage);\n  onShowSuccess();\n}\n\nexport {showErrorMessageGet, showErrorMessageSend, showSuccessMessageSend}\n","const SERVER = 'https://22.javascript.pages.academy/keksobooking';\n\nconst getData = (onSuccess, onFail) => {\n  fetch(`${SERVER}/data`)\n    .then((response) => response.json())\n    .then((adverts) => {\n      onSuccess(adverts);\n    })\n    .catch(() => {\n      onFail();\n    })\n};\n\nconst sendData = (onSuccess, onFail, body) => {\n  fetch(\n    SERVER,\n    {\n      method: 'POST',\n      body,\n    },\n  )\n    .then((response) => {\n      if (response.ok) {\n        onSuccess();\n      } else {\n        onFail();\n      }\n    })\n    .catch(() => {\n      onFail();\n    })\n}\n\nexport {getData, sendData}\n","const FILE_TYPES = ['gif', 'jpg', 'jpeg', 'png', 'svg'];\n\nconst showPreview = (input, preview) => {\n  input.addEventListener('change', () => {\n    const file = input.files[0];\n    const fileName = file.name.toLowerCase();\n\n    const matches = FILE_TYPES.some((it) => {\n      return fileName.endsWith(it);\n    });\n\n    if (matches) {\n      const reader = new FileReader();\n\n      reader.addEventListener('load', () => {\n        preview.src = reader.result;\n      });\n\n      reader.readAsDataURL(file);\n    }\n  })\n}\n\nexport {showPreview}\n\n","import {showErrorMessageSend, showSuccessMessageSend} from './popup-message.js';\nimport {sendData} from './server.js';\nimport {resetMap} from './map.js';\nimport {showPreview} from './preview.js';\n\nconst DEFAULT_IMG = 'img/muffin-grey.svg'\nconst TypePrice = {\n  BUNGALOW: 0,\n  FLAT: 1000,\n  HOUSE: 5000,\n  PALACE: 10000,\n}\n\nconst form = document.querySelector('.ad-form');\nconst filter = document.querySelector('.map__filters');\nconst fieldsets = form.querySelectorAll('fieldset');\nconst resetButton = form.querySelector('.ad-form__reset');\nconst type = form.querySelector('#type');\nconst price = form.querySelector('#price');\nconst timeIn = form.querySelector('#timein');\nconst timeOut = form.querySelector('#timeout');\nconst room = form.querySelector('#room_number');\nconst capacity = form.querySelector('#capacity');\n\nconst avatarInput  = form.querySelector('#avatar');\nconst photoInput = form.querySelector('#images');\nconst avatarPreview = form.querySelector('.ad-form-header__preview img')\nconst photoPreview = form.querySelector('.ad-form__photo img');\n\n/* Неактивное состояние формы */\n\nform.classList.add('ad-form--disabled');\nfieldsets.forEach((fieldset) => {\n  fieldset.setAttribute('disabled', 'disabled')\n});\n\n/* Активное состояние формы */\n\nconst activateForm = () => {\n  form.classList.remove('ad-form--disabled');\n  fieldsets.forEach((fieldset) => {\n    fieldset.removeAttribute('disabled')\n  });\n}\n\n/* Валидация формы */\n\nconst onSelectType = () => {\n  price.value = '';\n\n  switch (type.value) {\n    case 'flat':\n      return [price.placeholder = TypePrice.FLAT] [price.min = TypePrice.FLAT];\n    case 'bungalow':\n      return [price.placeholder = TypePrice.BUNGALOW] [price.min = TypePrice.BUNGALOW];\n    case 'house':\n      return [price.placeholder = TypePrice.HOUSE] [price.min = TypePrice.HOUSE];\n    case 'palace':\n      return [price.placeholder = TypePrice.PALACE] [price.min = TypePrice.PALACE];\n  }\n}\n\nconst onSelectCheckInOut = (evt) => {\n  timeIn.value = evt.target.value;\n  timeOut.value = evt.target.value;\n}\n\nconst onSelectRoom = () => {\n  if ((room.value === '100' && capacity.value !== '0') || (room.value !== '100' && capacity.value === '0')) {\n    room.setCustomValidity('Значению \"100 комнат\" должно соответствовать \"Не для гостей\"');\n    capacity.setCustomValidity('Значению \"100 комнат\" должно соответствовать \"Не для гостей\"');\n  } else if (room.value < capacity.value) {\n    room.setCustomValidity('');\n    capacity.setCustomValidity('Гостей не должно быть больше, чем комнат');\n  } else if (room.value === capacity.value || ((room.value === '100') && capacity.value === '0')) {\n    room.setCustomValidity('');\n    capacity.setCustomValidity('');\n  } else {\n    room.setCustomValidity('');\n    capacity.setCustomValidity('');\n  }\n}\n\nconst validateForm = () => {\n  type.addEventListener('change', onSelectType);\n  timeIn.addEventListener('change', onSelectCheckInOut);\n  timeOut.addEventListener('change', onSelectCheckInOut);\n  room.addEventListener('change', onSelectRoom);\n  capacity.addEventListener('change', onSelectRoom);\n}\n\nshowPreview(avatarInput, avatarPreview);\nshowPreview(photoInput, photoPreview);\n\n/* Отправка и сброс формы */\n\nconst resetImg = () => {\n  avatarPreview.src = DEFAULT_IMG;\n  photoPreview.src = DEFAULT_IMG;\n}\n\nconst resetForm = () => {\n  form.reset();\n  filter.reset();\n  resetMap();\n  resetImg();\n}\n\nconst handleSuccess = () => {\n  resetForm();\n  showSuccessMessageSend();\n}\n\nform.addEventListener('submit', (evt) => {\n  evt.preventDefault();\n\n  const formData = new FormData(evt.target);\n\n  sendData(handleSuccess, showErrorMessageSend, formData);\n  resetImg();\n});\n\nresetButton.addEventListener('click', (evt) => {\n  evt.preventDefault();\n\n  resetForm()\n})\n\nexport {activateForm, validateForm};\n","/* global L:readonly */\n\nimport {showAdvert} from './card-advert.js';\nimport {activateForm} from './form.js';\n\n/* Создание карты */\n\nconst MAIN_ICON_SIZE = 52;\nconst USUAL_ICON_SIZE = 40;\nconst centerTokyo =\n  {\n    lat: 35.65951,\n    lng: 139.72165,\n  }\n\nconst map = L.map('map-canvas')\n  .on('load', activateForm)\n  .setView({\n    lat: centerTokyo.lat,\n    lng: centerTokyo.lng,\n  }, 12);\n\nL.tileLayer(\n  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  {\n    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n  },\n).addTo(map);\n\n/* Главная метка */\n\nconst mainPinIcon = L.icon({\n  iconUrl: './img/main-pin.svg',\n  iconSize: [MAIN_ICON_SIZE, MAIN_ICON_SIZE],\n  iconAnchor: [MAIN_ICON_SIZE / 2, MAIN_ICON_SIZE],\n});\n\nconst mainPinMarker = L.marker(\n  {\n    lat: centerTokyo.lat,\n    lng: centerTokyo.lng,\n  },\n  {\n    draggable: true,\n    icon: mainPinIcon,\n  },\n);\n\nconst address = document.querySelector('#address');\naddress.value = `${centerTokyo.lat}, ${centerTokyo.lng}`;\nconst getCoordinates = ({lat, lng}) => {\n  address.value = `${lat.toFixed(5)}, ${lng.toFixed(5)}`;\n}\n\nmainPinMarker.addTo(map);\nmainPinMarker.on('drag', (evt) => {\n  getCoordinates(evt.target.getLatLng());\n});\n\nconst resetMap = () => {\n  mainPinMarker.setLatLng({\n    lat: centerTokyo.lat,\n    lng: centerTokyo.lng,\n  });\n  map.setView({\n    lat: centerTokyo.lat,\n    lng: centerTokyo.lng,\n  }, 12);\n  address.value = `${centerTokyo.lat}, ${centerTokyo.lng}`\n}\n\n/* Обычные метки */\n\nconst markers = L.layerGroup();\n\nconst usualPinIcon = L.icon({\n  iconUrl: './img/pin.svg',\n  iconSize: [USUAL_ICON_SIZE, USUAL_ICON_SIZE],\n  iconAnchor: [USUAL_ICON_SIZE / 2, USUAL_ICON_SIZE],\n})\n\nconst renderSimilarAdverts = (adverts) => {\n\n  adverts.forEach((advert) => {\n\n    const usualPinMarker = L.marker(\n      {\n        lat: advert.location.lat,\n        lng: advert.location.lng,\n      },\n      {\n        icon: usualPinIcon,\n      },\n    )\n\n    markers.addLayer(usualPinMarker)\n\n    usualPinMarker\n      .bindPopup(\n        showAdvert(advert),\n        {\n          keepInView: true,\n        },\n      );\n  })\n  markers.addTo(map);\n}\n\nconst clearMarkers = () => {\n  map.closePopup();\n  markers.clearLayers();\n}\n\nexport {resetMap, renderSimilarAdverts, clearMarkers};\n","import {renderSimilarAdverts, clearMarkers} from './map.js';\nimport {debounce} from './utility.js';\n\nconst SIMILAR_ADVERTS_COUNT = 10;\nconst DEFAULT = 'any';\nconst RERENDER_DELAY = 500;\nconst Price = {\n  LOW: 10000,\n  HIGH: 50000,\n};\n\nconst filter = document.querySelector('.map__filters');\nconst selects = document.querySelectorAll('fieldset, select');\n\nconst housingType = document.querySelector('#housing-type');\nconst housingPrice = document.querySelector('#housing-price');\nconst housingRooms = document.querySelector('#housing-rooms');\nconst housingGuests = document.querySelector('#housing-guests');\nconst housingFeatures = document.querySelector('#housing-features');\n\n/* Неактивное состояние фильтра */\n\nfilter.classList.add('map__filters--disabled');\nselects.forEach((select) => {\n  select.setAttribute('disabled', 'disabled')\n});\n\n/* Активное состояние фильтра */\n\nconst activateFilter = () => {\n  filter.classList.remove('map__filters--disabled')\n  selects.forEach((select) => {\n    select.removeAttribute('disabled')\n  });\n}\n\n/* Фильтрация */\n\nconst filterPrice = (data) => {\n  switch (housingPrice.value) {\n    case 'low':\n      return data.offer.price < Price.LOW;\n    case 'middle':\n      return data.offer.price >= Price.LOW && data.offer.price < Price.HIGH;\n    case 'high':\n      return data.offer.price >= Price.HIGH;\n    case 'any':\n      return true;\n  }\n};\n\nconst filterFeatures = (data) => {\n  const checkedFeatures = housingFeatures.querySelectorAll('input:checked')\n\n  if (checkedFeatures.length === 0) {\n    return true;\n  }\n\n  for (const feature of checkedFeatures) {\n    if(!data.offer.features.includes(feature.value)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nconst filterData = (data) => {\n  if ((data.offer.type === housingType.value || housingType.value === DEFAULT) &&\n    (data.offer.rooms === +housingRooms.value || housingRooms.value === DEFAULT) &&\n    (data.offer.guests === +housingGuests.value || housingGuests.value === DEFAULT) &&\n    (filterPrice(data)) &&\n    (filterFeatures(data))\n  ) {\n    return data;\n  }\n  return false;\n}\n\nconst onChangeFilter = debounce((adverts) => {\n  clearMarkers();\n  const similarAdverts = adverts.filter(filterData).slice(0, SIMILAR_ADVERTS_COUNT);\n  renderSimilarAdverts(similarAdverts)\n}, RERENDER_DELAY, false)\n\nconst onDataSuccess = (adverts) => {\n  activateFilter();\n  renderSimilarAdverts(adverts);\n\n  filter.addEventListener('change', () => {\n    onChangeFilter(adverts)\n  })\n  filter.addEventListener('reset', () => {\n    onChangeFilter(adverts)\n  })\n}\n\nexport {onDataSuccess};\n"],"sourceRoot":""}